(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["e45827de"],{d6148ab3:function(e,l,a){a.d(l,"__esModule",{value:!0}),a.e(l,{default:function(){return T;}});var t=a("777fffbe"),r=a("852bbaa9"),d=a("f1317d59"),o=a("6aa21787"),s=t._(o),n=a("c4f784d0"),i=a("7f218433"),c=a("5f5abd30"),u=t._(c),f=a("560f8ccf"),h=t._(f),m=a("e4c810ea"),_=t._(m),b=a("864c62b1"),y=r._(b),x=a("5619e6cc"),g=a("3ad4cd96"),p=a("f532449e"),v=t._(p),k=a("acb4a2ed"),j=t._(k),w=a("b367d8c7"),C=t._(w),S=a("559eb373");let R=({visible:e,onCancel:l,onSubmit:a,title:t,initialValues:r})=>{let o=!!r,[s,n]=(0,y.useState)([]),[i,c]=(0,y.useState)([]);(0,y.useEffect)(()=>{e&&(f(),o&&(null==r?void 0:r.role_code)?m(r.role_code):c([]));},[e,o,null==r?void 0:r.role_code]);let f=async()=>{try{let e=await (0,S.getMenuTree)();if(200===e.code&&e.data){let l=b(e.data);n(l);}}catch(e){console.error("\u52A0\u8F7D\u83DC\u5355\u6811\u5931\u8D25:",e);}},m=async e=>{try{let l=await (0,x.getRoleMenus)(e);if(200===l.code&&l.data){let e=l.data.map(e=>e.menu_code);c(e);}}catch(e){console.error("\u52A0\u8F7D\u89D2\u8272\u83DC\u5355\u5931\u8D25:",e);}},b=e=>e.map(e=>({title:`${e.menu_name} (${e.menu_code})`,key:e.menu_code,children:e.children?b(e.children):void 0}));return(0,d.jsx)(_.default,{title:t,open:e,onCancel:l,footer:null,width:600,children:(0,d.jsxs)(g.ProForm,{initialValues:r,onFinish:async e=>{try{await a(e);let l=o?null==r?void 0:r.role_code:e.role_code;if(l&&i.length>=0)try{let e=i.map(e=>String(e)),a=await (0,x.setRoleMenus)(l,e);200===a.code&&i.length>0&&h.default.success("\u83DC\u5355\u6743\u9650\u5206\u914D\u6210\u529F");}catch(e){h.default.warning("\u89D2\u8272\u4FE1\u606F\u5DF2\u4FDD\u5B58\uFF0C\u4F46\u83DC\u5355\u6743\u9650\u5206\u914D\u5931\u8D25");}}catch(e){}},submitter:{render:(e,a)=>[(0,d.jsx)(u.default,{onClick:l,children:"\u53D6\u6D88"},"cancel"),(0,d.jsx)(u.default,{type:"primary",onClick:()=>{var l,a;return null===(a=e.form)||void 0===a?void 0:null===(l=a.submit)||void 0===l?void 0:l.call(a);},children:"\u786E\u5B9A"},"submit")]},children:[!o&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(v.default,{name:"role_code",label:"\u89D2\u8272\u7F16\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801"}]}),(0,d.jsx)(v.default,{name:"role_name",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}]}),(0,d.jsx)(v.default,{name:"role_key",label:"\u89D2\u8272\u6807\u8BC6",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u6807\u8BC6"}]})]}),o&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(v.default,{name:"role_name",label:"\u89D2\u8272\u540D\u79F0"}),(0,d.jsx)(v.default,{name:"role_key",label:"\u89D2\u8272\u6807\u8BC6"})]}),(0,d.jsx)(j.default,{name:"data_scope",label:"\u6570\u636E\u6743\u9650",options:[{label:"\u5168\u90E8\u6570\u636E",value:"all"},{label:"\u90E8\u95E8\u6570\u636E",value:"dept"},{label:"\u90E8\u95E8\u53CA\u4EE5\u4E0B",value:"dept_and_child"},{label:"\u4EC5\u672C\u4EBA",value:"self"}]}),(0,d.jsx)(j.default,{name:"status",label:"\u72B6\u6001",options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}),(0,d.jsx)(g.ProForm.Item,{label:"\u83DC\u5355\u6743\u9650",children:(0,d.jsx)(C.default,{checkable:!0,treeData:s,checkedKeys:i,onCheck:e=>{c(e);},style:{maxHeight:"300px",overflow:"auto"}})})]})});},T=()=>{let[e,l]=(0,y.useState)(!1),[a,t]=(0,y.useState)(!1),[r,o]=(0,y.useState)(null),c=(0,y.useRef)(),f=async e=>{try{let t=await (0,x.createRole)(e);if(200===t.code){var a;h.default.success("\u521B\u5EFA\u6210\u529F"),l(!1),null===(a=c.current)||void 0===a||a.reload();}else throw h.default.error(t.message||"\u521B\u5EFA\u5931\u8D25"),Error(t.message||"\u521B\u5EFA\u5931\u8D25");}catch(e){throw h.default.error("\u521B\u5EFA\u5931\u8D25"),e;}},m=async e=>{if(r)try{let a=await (0,x.updateRole)(r.role_code,e);if(200===a.code){var l;h.default.success("\u66F4\u65B0\u6210\u529F"),t(!1),o(null),null===(l=c.current)||void 0===l||l.reload();}else throw h.default.error(a.message||"\u66F4\u65B0\u5931\u8D25"),Error(a.message||"\u66F4\u65B0\u5931\u8D25");}catch(e){throw h.default.error("\u66F4\u65B0\u5931\u8D25"),e;}},b=e=>{_.default.confirm({title:"\u786E\u8BA4\u5220\u9664",content:`\u{786E}\u{5B9A}\u{8981}\u{5220}\u{9664}\u{89D2}\u{8272} "${e.role_name}" \u{5417}\u{FF1F}`,onOk:async()=>{try{let a=await (0,x.deleteRole)(e.role_code);if(200===a.code){var l;h.default.success("\u5220\u9664\u6210\u529F"),null===(l=c.current)||void 0===l||l.reload();}else h.default.error(a.message||"\u5220\u9664\u5931\u8D25");}catch(e){h.default.error("\u5220\u9664\u5931\u8D25");}}});},g=[{title:"\u89D2\u8272\u7F16\u7801",dataIndex:"role_code",key:"role_code",width:120},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role_name",key:"role_name",width:120},{title:"\u89D2\u8272\u6807\u8BC6",dataIndex:"role_key",key:"role_key",width:120},{title:"\u6570\u636E\u6743\u9650",dataIndex:"data_scope",key:"data_scope",width:120},{title:"\u72B6\u6001",dataIndex:"status",key:"status",width:80,valueEnum:{1:{text:"\u542F\u7528",status:"Success"},0:{text:"\u7981\u7528",status:"Error"}}},{title:"\u64CD\u4F5C",key:"action",width:180,fixed:"right",render:(e,l)=>[(0,d.jsx)(u.default,{type:"link",size:"small",onClick:()=>{o(l),t(!0);},children:"\u7F16\u8F91"},"edit"),(0,d.jsx)(u.default,{type:"link",size:"small",danger:!0,onClick:()=>b(l),children:"\u5220\u9664"},"delete")]}];return(0,d.jsxs)(n.PageContainer,{children:[(0,d.jsx)(i.ProTable,{headerTitle:"\u89D2\u8272\u7BA1\u7406",actionRef:c,rowKey:"role_code",search:{labelWidth:"auto"},toolBarRender:()=>[(0,d.jsxs)(u.default,{type:"primary",onClick:()=>{l(!0);},children:[(0,d.jsx)(s.default,{})," \u65B0\u5EFA"]},"primary")],request:async e=>{let l=await (0,x.getRoleList)({page:e.current||1,page_size:e.pageSize||10});return 200===l.code&&l.data?{data:l.data.items,success:!0,total:l.data.total}:{data:[],success:!1,total:0};},columns:g}),(0,d.jsx)(R,{visible:e,onCancel:()=>l(!1),onSubmit:f,title:"\u65B0\u5EFA\u89D2\u8272"}),r&&(0,d.jsx)(R,{visible:a,onCancel:()=>{t(!1),o(null);},onSubmit:m,title:"\u7F16\u8F91\u89D2\u8272",initialValues:r})]});};}}]);
//# sourceMappingURL=e45827de-async.0bc9f60d.js.map