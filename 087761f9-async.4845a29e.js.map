{"version":3,"sources":["src/services/shiyu-api/data_manage.ts","src/pages/system/data-manage/index.tsx"],"sourcesContent":["import { request } from '@umijs/max';\r\n\r\nexport interface TableMeta {\r\n  table_name: string;\r\n  table_type: string;\r\n}\r\n\r\nexport interface ColumnMeta {\r\n  column_name: string;\r\n  data_type: string;\r\n  is_nullable: boolean;\r\n  max_length?: number;\r\n  column_default?: string;\r\n}\r\n\r\nexport interface TableDataPage {\r\n  items: Record<string, any>[];\r\n  page: number;\r\n  size: number;\r\n  total: number;\r\n}\r\n\r\n/** 获取所有表列表 */\r\nexport async function getTables() {\r\n  return request<{\r\n    code: number;\r\n    data: TableMeta[];\r\n    message?: string;\r\n  }>('/api/v1/system/data/tables', {\r\n    method: 'GET',\r\n  });\r\n}\r\n\r\n/** 获取指定表的字段列表 */\r\nexport async function getTableColumns(table: string) {\r\n  return request<{\r\n    code: number;\r\n    data: ColumnMeta[];\r\n    message?: string;\r\n  }>(`/api/v1/system/data/tables/${table}/columns`, {\r\n    method: 'GET',\r\n  });\r\n}\r\n\r\n/** 分页获取指定表的数据 */\r\nexport async function getTableRows(table: string, params?: { page?: number; page_size?: number }) {\r\n  return request<{\r\n    code: number;\r\n    data: TableDataPage;\r\n    message?: string;\r\n  }>(`/api/v1/system/data/tables/${table}/rows`, {\r\n    method: 'GET',\r\n    params,\r\n  });\r\n}\r\n","import type { ProColumns } from '@ant-design/pro-components';\r\nimport { PageContainer, ProCard, ProTable } from '@ant-design/pro-components';\r\nimport React, { useState } from 'react';\r\nimport type { TableMeta, ColumnMeta } from '@/services/shiyu-api/data_manage';\r\nimport { getTables, getTableColumns, getTableRows } from '@/services/shiyu-api/data_manage';\r\n\r\nconst DataManagePage: React.FC = () => {\r\n  const [currentTable, setCurrentTable] = useState<string | undefined>();\r\n  const [columnsMeta, setColumnsMeta] = useState<ColumnMeta[]>([]);\r\n\r\n  const tableColumns: ProColumns<TableMeta>[] = [\r\n    {\r\n      title: '表名',\r\n      dataIndex: 'table_name',\r\n      key: 'table_name',\r\n    },\r\n    {\r\n      title: '类型',\r\n      dataIndex: 'table_type',\r\n      key: 'table_type',\r\n    },\r\n  ];\r\n\r\n  const columnColumns: ProColumns<ColumnMeta>[] = [\r\n    {\r\n      title: '字段名',\r\n      dataIndex: 'column_name',\r\n      key: 'column_name',\r\n    },\r\n    {\r\n      title: '数据类型',\r\n      dataIndex: 'data_type',\r\n      key: 'data_type',\r\n    },\r\n    {\r\n      title: '可为空',\r\n      dataIndex: 'is_nullable',\r\n      key: 'is_nullable',\r\n      render: (value: boolean | undefined) => (value ? '是' : '否'),\r\n    },\r\n    {\r\n      title: '最大长度',\r\n      dataIndex: 'max_length',\r\n      key: 'max_length',\r\n      render: (value: number | undefined) => (value != null ? value : '-'),\r\n    },\r\n    {\r\n      title: '默认值',\r\n      dataIndex: 'column_default',\r\n      key: 'column_default',\r\n      ellipsis: true,\r\n      render: (value: string | undefined) => value || '-',\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <PageContainer>\r\n      <ProCard split=\"vertical\" bordered>\r\n        <ProCard title=\"数据表\" colSpan=\"40%\">\r\n          <ProTable<TableMeta>\r\n            rowKey=\"table_name\"\r\n            search={false}\r\n            pagination={false}\r\n            toolBarRender={false}\r\n            request={async () => {\r\n              const res = await getTables();\r\n              if (res.code === 200 && res.data) {\r\n                if (!currentTable && res.data.length > 0) {\r\n                  setCurrentTable(res.data[0].table_name);\r\n                }\r\n                return {\r\n                  data: res.data,\r\n                  success: true,\r\n                };\r\n              }\r\n              return {\r\n                data: [],\r\n                success: false,\r\n              };\r\n            }}\r\n            columns={tableColumns}\r\n            onRow={(record: TableMeta) => {\r\n              return {\r\n                onClick: () => {\r\n                  setCurrentTable(record.table_name);\r\n                },\r\n              };\r\n            }}\r\n          />\r\n        </ProCard>\r\n        <ProCard title={currentTable ? `表信息（${currentTable}）` : '表信息'} split=\"horizontal\">\r\n          <ProCard title=\"字段\">\r\n            <ProTable<ColumnMeta>\r\n              rowKey=\"column_name\"\r\n              search={false}\r\n              pagination={false}\r\n              toolBarRender={false}\r\n              request={async () => {\r\n                if (!currentTable) {\r\n                  setColumnsMeta([]);\r\n                  return {\r\n                    data: [],\r\n                    success: true,\r\n                  };\r\n                }\r\n                const res = await getTableColumns(currentTable);\r\n                if (res.code === 200 && res.data) {\r\n                  setColumnsMeta(res.data);\r\n                  return {\r\n                    data: res.data,\r\n                    success: true,\r\n                  };\r\n                }\r\n                setColumnsMeta([]);\r\n                return {\r\n                  data: [],\r\n                  success: false,\r\n                };\r\n              }}\r\n              columns={columnColumns}\r\n            />\r\n          </ProCard>\r\n          <ProCard title=\"数据\">\r\n            <ProTable<Record<string, any>>\r\n              rowKey=\"_row_key\"\r\n              search={false}\r\n              pagination={{\r\n                defaultPageSize: 10,\r\n              }}\r\n              toolBarRender={false}\r\n              request={async (params) => {\r\n                if (!currentTable) {\r\n                  return {\r\n                    data: [],\r\n                    success: true,\r\n                    total: 0,\r\n                  };\r\n                }\r\n                const res = await getTableRows(currentTable, {\r\n                  page: params.current || 1,\r\n                  page_size: params.pageSize || 10,\r\n                });\r\n                if (res.code === 200 && res.data) {\r\n                  const itemsWithKey = (res.data.items || []).map((row, index) => ({\r\n                    _row_key:\r\n                      row.id !== undefined && row.id !== null\r\n                        ? String(row.id)\r\n                        : `${res.data.page}-${index}`,\r\n                    ...row,\r\n                  }));\r\n                  return {\r\n                    data: itemsWithKey,\r\n                    success: true,\r\n                    total: res.data.total,\r\n                  };\r\n                }\r\n                return {\r\n                  data: [],\r\n                  success: false,\r\n                  total: 0,\r\n                };\r\n              }}\r\n              columns={\r\n                columnsMeta.length > 0\r\n                  ? (columnsMeta.map((col) => ({\r\n                      title: col.column_name,\r\n                      dataIndex: col.column_name,\r\n                      key: col.column_name,\r\n                      ellipsis: true,\r\n                    })) as ProColumns<Record<string, any>>[])\r\n                  : [\r\n                      {\r\n                        title: '无字段信息',\r\n                        dataIndex: '_',\r\n                        render: () => '-',\r\n                      } as ProColumns<Record<string, any>>,\r\n                    ]\r\n              }\r\n            />\r\n          </ProCard>\r\n        </ProCard>\r\n      </ProCard>\r\n    </PageContainer>\r\n  );\r\n};\r\n\r\nexport default DataManagePage;\r\n"],"names":[],"mappings":"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"}