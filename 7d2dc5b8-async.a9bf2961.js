(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["7d2dc5b8"],{d714a43c:function(e,t,a){a.d(t,"__esModule",{value:!0}),a.e(t,{default:function(){return F;}});var l=a("777fffbe"),s=a("852bbaa9"),r=a("f1317d59"),d=a("6aa21787"),n=l._(d),u=a("c4f784d0"),o=a("7f218433"),i=a("5f5abd30"),c=l._(i),f=a("560f8ccf"),m=l._(f),h=a("e4c810ea"),y=l._(h),p=a("864c62b1"),v=s._(p),_=a("9ee30b17");async function b(e){return(0,_.request)("/api/v1/system/users",{method:"GET",params:e});}async function x(e){return(0,_.request)("/api/v1/system/users",{method:"POST",data:e});}async function g(e,t){return(0,_.request)(`/api/v1/system/users/${e}`,{method:"PUT",data:t});}async function w(e){return(0,_.request)(`/api/v1/system/users/${e}`,{method:"DELETE"});}async function j(e){return(0,_.request)(`/api/v1/system/users/${e}/roles`,{method:"GET"});}async function k(e,t){return(0,_.request)(`/api/v1/system/users/${e}/roles`,{method:"PUT",data:{role_codes:t}});}var C=a("3ad4cd96"),T=a("f532449e"),q=l._(T),E=a("acb4a2ed"),S=l._(E),P=a("5619e6cc");let I=({visible:e,onCancel:t,onSubmit:a,title:l,initialValues:s})=>{let d=!!s,[n,u]=(0,v.useState)([]),[o,i]=(0,v.useState)([]),f=(0,v.useRef)(null);(0,v.useEffect)(()=>{if(e){if(h(),d&&(null==s?void 0:s.user_code))p(s.user_code);else{var t;i([]),null===(t=f.current)||void 0===t||t.setFieldsValue({role_codes:[]});}}},[e,d,null==s?void 0:s.user_code]);let h=async()=>{try{let e=await (0,P.getRoleList)({page:1,page_size:1e3});if(200===e.code&&e.data){let t=e.data.items.map(e=>({label:e.role_name,value:e.role_code}));u(t);}}catch(e){console.error("\u52A0\u8F7D\u89D2\u8272\u5217\u8868\u5931\u8D25:",e);}},p=async e=>{try{let a=await j(e);if(200===a.code&&a.data){var t;let e=a.data.map(e=>e.role_code);i(e),null===(t=f.current)||void 0===t||t.setFieldsValue({role_codes:e});}}catch(e){console.error("\u52A0\u8F7D\u7528\u6237\u89D2\u8272\u5931\u8D25:",e);}};return(0,r.jsx)(y.default,{title:l,open:e,onCancel:t,footer:null,width:600,children:(0,r.jsxs)(C.ProForm,{formRef:f,initialValues:s,onFinish:async e=>{try{await a(e);let t=d?null==s?void 0:s.user_code:e.user_code;if(t&&o.length>=0)try{let e=await k(t,o);200===e.code&&o.length>0&&m.default.success("\u89D2\u8272\u5206\u914D\u6210\u529F");}catch(e){m.default.warning("\u7528\u6237\u4FE1\u606F\u5DF2\u4FDD\u5B58\uFF0C\u4F46\u89D2\u8272\u5206\u914D\u5931\u8D25");}}catch(e){}},submitter:{render:(e,a)=>[(0,r.jsx)(c.default,{onClick:t,children:"\u53D6\u6D88"},"cancel"),(0,r.jsx)(c.default,{type:"primary",onClick:()=>{var t,a;return null===(a=e.form)||void 0===a?void 0:null===(t=a.submit)||void 0===t?void 0:t.call(a);},children:"\u786E\u5B9A"},"submit")]},children:[!d&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(q.default,{name:"user_code",label:"\u7528\u6237\u7F16\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u7F16\u7801"}]}),(0,r.jsx)(q.default,{name:"username",label:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"}]}),(0,r.jsx)(q.default.Password,{name:"password",label:"\u5BC6\u7801",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}]})]}),(0,r.jsx)(q.default,{name:"nickname",label:"\u6635\u79F0"}),(0,r.jsx)(q.default,{name:"email",label:"\u90AE\u7BB1"}),(0,r.jsx)(q.default,{name:"phone",label:"\u624B\u673A\u53F7"}),(0,r.jsx)(q.default,{name:"dept_code",label:"\u90E8\u95E8\u7F16\u7801"}),(0,r.jsx)(S.default,{name:"status",label:"\u72B6\u6001",options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}),d&&(0,r.jsx)(q.default.Password,{name:"password",label:"\u65B0\u5BC6\u7801\uFF08\u7559\u7A7A\u4E0D\u4FEE\u6539\uFF09"}),(0,r.jsx)(S.default,{name:"role_codes",label:"\u89D2\u8272",mode:"multiple",options:n,fieldProps:{value:o,onChange:e=>{var t;i(e),null===(t=f.current)||void 0===t||t.setFieldsValue({role_codes:e});}},placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272"})]})});},F=()=>{let[e,t]=(0,v.useState)(!1),[a,l]=(0,v.useState)(!1),[s,d]=(0,v.useState)(null),i=(0,v.useRef)(),f=async e=>{try{let l=await x(e);if(200===l.code){var a;m.default.success("\u521B\u5EFA\u6210\u529F"),t(!1),null===(a=i.current)||void 0===a||a.reload();}else throw m.default.error(l.message||"\u521B\u5EFA\u5931\u8D25"),Error(l.message||"\u521B\u5EFA\u5931\u8D25");}catch(e){throw m.default.error("\u521B\u5EFA\u5931\u8D25"),e;}},h=async e=>{if(s)try{let a=await g(s.user_code,e);if(200===a.code){var t;m.default.success("\u66F4\u65B0\u6210\u529F"),l(!1),d(null),null===(t=i.current)||void 0===t||t.reload();}else throw m.default.error(a.message||"\u66F4\u65B0\u5931\u8D25"),Error(a.message||"\u66F4\u65B0\u5931\u8D25");}catch(e){throw m.default.error("\u66F4\u65B0\u5931\u8D25"),e;}},p=e=>{y.default.confirm({title:"\u786E\u8BA4\u5220\u9664",content:`\u{786E}\u{5B9A}\u{8981}\u{5220}\u{9664}\u{7528}\u{6237} "${e.username}" \u{5417}\u{FF1F}`,onOk:async()=>{try{let a=await w(e.user_code);if(200===a.code){var t;m.default.success("\u5220\u9664\u6210\u529F"),null===(t=i.current)||void 0===t||t.reload();}else m.default.error(a.message||"\u5220\u9664\u5931\u8D25");}catch(e){m.default.error("\u5220\u9664\u5931\u8D25");}}});},_=[{title:"\u7528\u6237\u7F16\u7801",dataIndex:"user_code",key:"user_code",width:120},{title:"\u7528\u6237\u540D",dataIndex:"username",key:"username",width:120},{title:"\u6635\u79F0",dataIndex:"nickname",key:"nickname",width:120},{title:"\u90AE\u7BB1",dataIndex:"email",key:"email",width:180},{title:"\u624B\u673A\u53F7",dataIndex:"phone",key:"phone",width:120},{title:"\u90E8\u95E8\u7F16\u7801",dataIndex:"dept_code",key:"dept_code",width:120},{title:"\u72B6\u6001",dataIndex:"status",key:"status",width:80,valueEnum:{1:{text:"\u542F\u7528",status:"Success"},0:{text:"\u7981\u7528",status:"Error"}}},{title:"\u64CD\u4F5C",key:"action",width:180,fixed:"right",render:(e,t)=>[(0,r.jsx)(c.default,{type:"link",size:"small",onClick:()=>{d(t),l(!0);},children:"\u7F16\u8F91"},"edit"),(0,r.jsx)(c.default,{type:"link",size:"small",danger:!0,onClick:()=>p(t),children:"\u5220\u9664"},"delete")]}];return(0,r.jsxs)(u.PageContainer,{children:[(0,r.jsx)(o.ProTable,{headerTitle:"\u7528\u6237\u7BA1\u7406",actionRef:i,rowKey:"user_code",search:{labelWidth:"auto"},toolBarRender:()=>[(0,r.jsxs)(c.default,{type:"primary",onClick:()=>{t(!0);},children:[(0,r.jsx)(n.default,{})," \u65B0\u5EFA"]},"primary")],request:async e=>{let t=await b({page:e.current||1,page_size:e.pageSize||10});return 200===t.code&&t.data?{data:t.data.items,success:!0,total:t.data.total}:{data:[],success:!1,total:0};},columns:_}),(0,r.jsx)(I,{visible:e,onCancel:()=>t(!1),onSubmit:f,title:"\u65B0\u5EFA\u7528\u6237"}),s&&(0,r.jsx)(I,{visible:a,onCancel:()=>{l(!1),d(null);},onSubmit:h,title:"\u7F16\u8F91\u7528\u6237",initialValues:s})]});};}}]);
//# sourceMappingURL=7d2dc5b8-async.a9bf2961.js.map